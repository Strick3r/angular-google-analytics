/**
 * Angular Google Analytics - Easy tracking for your AngularJS application
 * @version v1.1.7 - 2016-03-25
 * @link http://github.com/revolunet/angular-google-analytics
 * @author Julien Bouquillon <julien@revolunet.com> (https://github.com/revolunet)
 * @contributors Julien Bouquillon (https://github.com/revolunet),Justin Saunders (https://github.com/justinsa),Chris Esplin (https://github.com/deltaepsilon),Adam Misiorny (https://github.com/adam187)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(t,n){"use strict";"function"==typeof define&&define.amd?define(["angular"],n):"object"==typeof module&&module.exports?module.exports=n(require("angular")):n(t.angular)}(this,function(t,n){"use strict";return t.module("angular-google-analytics",[]).provider("Analytics",function(){var e,i,r,a,c,o=!0,s="auto",u=!1,l=!1,f="USD",d=!1,m=!1,p=!1,g=!1,h=!1,k=!1,y=!1,v=!1,E=!1,b=!1,w=!1,T="$routeChangeSuccess",A=!1,D=!1,C=!1,P="",x=!0,j=!1;this.log=[],this.offlineQueue=[],this.setAccount=function(i){return e=t.isUndefined(i)||i===!1?n:t.isArray(i)?i:t.isObject(i)?[i]:[{tracker:i,trackEvent:!0}],this},this.trackPages=function(t){return x=!!t,this},this.trackPrefix=function(t){return P=t,this},this.setDomainName=function(t){return r=t,this},this.useDisplayFeatures=function(t){return p=!!t,this},this.useAnalytics=function(t){return o=!!t,this},this.useEnhancedLinkAttribution=function(t){return y=!!t,this},this.useCrossDomainLinker=function(t){return l=!!t,this},this.setCrossLinkDomains=function(t){return i=t,this},this.setPageEvent=function(t){return T=t,this},this.setCookieConfig=function(t){return s=t,this},this.useECommerce=function(t,n){return h=!!t,k=!!n,this},this.setCurrency=function(t){return f=t,this},this.setRemoveRegExp=function(t){return t instanceof RegExp&&(c=t),this},this.setExperimentId=function(t){return a=t,this},this.ignoreFirstPageLoad=function(t){return v=!!t,this},this.trackUrlParams=function(t){return j=!!t,this},this.disableAnalytics=function(t){return g=!!t,this},this.setHybridMobileSupport=function(t){return b=!!t,this},this.startOffline=function(t){return w=!!t,w===!0&&this.delayScriptTag(!0),this},this.delayScriptTag=function(t){return m=!!t,this},this.logAllCalls=function(t){return E=!!t,this},this.enterTestMode=function(){return D=!0,this},this.enterDebugMode=function(t){return d=!0,C=!!t,this},this.readFromRoute=function(t){return A=!!t,this},this.$get=["$document","$location","$log","$rootScope","$window","$injector",function(L,S,I,q,$,N){var F=this,O=function(n,e){return t.isObject(e)&&t.isDefined(e[n])},M=function(t,n,e){return O(t,n)&&n[t]===e},U=function(n,e){return t.isString(e)?e+"."+n:O("name",e)?e.name+"."+n:n},R={};A&&(N.has("$route")?R=N.get("$route"):I.warn("$route service is not available. Make sure you have included ng-route in your application dependencies."));var B=function(){if(A&&R.current&&"pageTrack"in R.current)return R.current.pageTrack;var t=j?S.url():S.path();return c?t.replace(c,""):t},Q=function(){var n={utm_source:"campaignSource",utm_medium:"campaignMedium",utm_term:"campaignTerm",utm_content:"campaignContent",utm_campaign:"campaignName"},e={};return t.forEach(S.search(),function(i,r){var a=n[r];t.isDefined(a)&&(e[a]=i)}),e},V=function(t,n,e,i,r,a,c,o,s){var u={};return t&&(u.id=t),n&&(u.affiliation=n),e&&(u.revenue=e),i&&(u.tax=i),r&&(u.shipping=r),a&&(u.coupon=a),c&&(u.list=c),o&&(u.step=o),s&&(u.option=s),u},X=function(t){!o&&$._gaq&&"function"==typeof t&&t()},G=function(){var t=Array.prototype.slice.call(arguments);return w===!0?void F.offlineQueue.push([G,t]):($._gaq||($._gaq=[]),E===!0&&F._log.apply(F,t),void $._gaq.push(t))},H=function(t){o&&$.ga&&"function"==typeof t&&t()},z=function(){var t=Array.prototype.slice.call(arguments);return w===!0?void F.offlineQueue.push([z,t]):"function"!=typeof $.ga?void F._log("warn","ga function not set on window"):(E===!0&&F._log.apply(F,t),void $.ga.apply(null,t))},J=function(t){var n=Array.prototype.slice.call(arguments,1).filter(Boolean),i=n[0],r=[];if("function"==typeof t)e.forEach(function(n){t(n)&&r.push(n)});else if(r=e,"undefined"!==t){var a=_.findIndex(e,{name:t});r=a>=0?[e[a]]:e}return 0===r.length?void z.apply(F,n):void r.forEach(function(t){(!O("select",t)||"function"!=typeof t.select||t.select(n))&&(n[0]=U(i,t),z.apply(F,n))})};return this._log=function(){var t=Array.prototype.slice.call(arguments);if(t.length>0){if(t.length>1)switch(t[0]){case"debug":case"error":case"info":case"log":case"warn":I[t[0]](t.slice(1))}F.log.push(t)}},this._createScriptTag=function(){if(!e||e.length<1)return void F._log("warn","No account id set to create script tag");if(e.length>1&&(F._log("warn","Multiple trackers are not supported with ga.js. Using first tracker only"),e=e.slice(0,1)),u===!0)return void F._log("warn","ga.js or analytics.js script tag already created");g===!0&&(F._log("info","Analytics disabled: "+e[0].tracker),$["ga-disable-"+e[0].tracker]=!0),G("_setAccount",e[0].tracker),r&&G("_setDomainName",r),y&&G("_require","inpage_linkid","//www.google-analytics.com/plugins/ga/inpage_linkid.js"),x&&!v&&(c?G("_trackPageview",B()):G("_trackPageview"));var t,n=L[0];return t=p===!0?("https:"===n.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":("https:"===n.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",D!==!0?!function(){var e=n.createElement("script");e.type="text/javascript",e.async=!0,e.src=t;var i=n.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}():F._log("inject",t),u=!0,!0},this._createAnalyticsScriptTag=function(){if(!e)return void F._log("warn","No account id set to create analytics script tag");if(u===!0)return void F._log("warn","ga.js or analytics.js script tag already created");g===!0&&e.forEach(function(t){F._log("info","Analytics disabled: "+t.tracker),$["ga-disable-"+t.tracker]=!0});var n=L[0],r=b===!0?"https:":"",c=r+"//www.google-analytics.com/"+(d?"analytics_debug.js":"analytics.js");if(D!==!0?!function(t,n,e,i,r,a,c){t.GoogleAnalyticsObject=r,t[r]=t[r]||function(){(t[r].q=t[r].q||[]).push(arguments)},t[r].l=1*new Date,a=n.createElement(e),c=n.getElementsByTagName(e)[0],a.async=1,a.src=i,c.parentNode.insertBefore(a,c)}(window,n,"script",c,"ga"):("function"!=typeof $.ga&&($.ga=function(){}),F._log("inject",c)),C&&($.ga_debug={trace:!0}),e.forEach(function(n){n.crossDomainLinker=O("crossDomainLinker",n)?n.crossDomainLinker:l,n.crossLinkDomains=O("crossLinkDomains",n)?n.crossLinkDomains:i,n.displayFeatures=O("displayFeatures",n)?n.displayFeatures:p,n.enhancedLinkAttribution=O("enhancedLinkAttribution",n)?n.enhancedLinkAttribution:y,n.set=O("set",n)?n.set:{},n.trackEcommerce=O("trackEcommerce",n)?n.trackEcommerce:h,n.trackEvent=O("trackEvent",n)?n.trackEvent:!1;var e={};O("fields",n)?e=n.fields:O("cookieConfig",n)?t.isString(n.cookieConfig)?e.cookieDomain=n.cookieConfig:e=n.cookieConfig:t.isString(s)?e.cookieDomain=s:s&&(e=s),n.crossDomainLinker===!0&&(e.allowLinker=!0),O("name",n)&&(e.name=n.name),n.fields=e,z("create",n.tracker,n.fields),b===!0&&z(U("set",n),"checkProtocolTask",null);for(var r in n.set)n.set.hasOwnProperty(r)&&z(U("set",n),r,n.set[r]);n.crossDomainLinker===!0&&(z(U("require",n),"linker"),t.isDefined(n.crossLinkDomains)&&z(U("linker:autoLink",n),n.crossLinkDomains)),n.displayFeatures&&z(U("require",n),"displayfeatures"),n.trackEcommerce&&(k?(z(U("require",n),"ec"),z(U("set",n),"&cu",f)):z(U("require",n),"ecommerce")),n.enhancedLinkAttribution&&z(U("require",n),"linkid"),x&&!v&&z(U("send",n),"pageview",P+B())}),a){var o=n.createElement("script"),m=n.getElementsByTagName("script")[0];o.src=r+"//www.google-analytics.com/cx/api.js?experiment="+a,m.parentNode.insertBefore(o,m)}return u=!0,!0},this._ecommerceEnabled=function(t,n){var e=h&&!k;return t===!0&&e===!1&&(h&&k?F._log("warn",n+" is not available when Enhanced Ecommerce is enabled with analytics.js"):F._log("warn","Ecommerce must be enabled to use "+n+" with analytics.js")),e},this._enhancedEcommerceEnabled=function(t,n){var e=h&&k;return t===!0&&e===!1&&F._log("warn","Enhanced Ecommerce must be enabled to use "+n+" with analytics.js"),e},this._trackPage=function(n,e,i,r,a){e=e?e:B(),i=i?i:L[0].title,X(function(){G("_set","title",i),G("_trackPageview",P+e)}),H(function(){var a={page:P+e,title:i};t.extend(a,Q()),t.isObject(r)&&t.extend(a,r),J(n,"send","pageview",a)})},this._trackEvent=function(n,e,i,r,a,c){X(function(){G("_trackEvent",n,e,i,r,!!a)}),H(function(){var o={},s=function(t){return M("trackEvent",t,!0)};t.isDefined(a)&&(o.nonInteraction=!!a),t.isObject(c)&&t.extend(o,c),t.isDefined(o.page)||(o.page=B()),J(s,"send","event",n,e,i,r,o)})},this._addTrans=function(t,n,e,i,r,a,c,o,s){X(function(){G("_addTrans",t,n,e,i,r,a,c,o)}),H(function(){if(F._ecommerceEnabled(!0,"addTrans")){var a=function(t){return M("trackEcommerce",t,!0)};J(a,"ecommerce:addTransaction",{id:t,affiliation:n,revenue:e,tax:i,shipping:r,currency:s||"USD"})}})},this._addItem=function(t,n,e,i,r,a){X(function(){G("_addItem",t,n,e,i,r,a)}),H(function(){if(F._ecommerceEnabled(!0,"addItem")){var c=function(t){return M("trackEcommerce",t,!0)};J(c,"ecommerce:addItem",{id:t,name:e,sku:n,category:i,price:r,quantity:a})}})},this._trackTrans=function(){X(function(){G("_trackTrans")}),H(function(){if(F._ecommerceEnabled(!0,"trackTrans")){var t=function(t){return M("trackEcommerce",t,!0)};J(t,"ecommerce:send")}})},this._clearTrans=function(){H(function(){if(F._ecommerceEnabled(!0,"clearTrans")){var t=function(t){return M("trackEcommerce",t,!0)};J(t,"ecommerce:clear")}})},this._addProduct=function(n,e,i,r,a,c,o,s,u,l){X(function(){G("_addProduct",n,e,i,r,a,c,o,s,u)}),H(function(){if(F._enhancedEcommerceEnabled(!0,"addProduct")){var f=function(t){return M("trackEcommerce",t,!0)},d={id:n,name:e,category:i,brand:r,variant:a,price:c,quantity:o,coupon:s,position:u};t.isObject(l)&&t.extend(d,l),J(f,"ec:addProduct",d)}})},this._addImpression=function(t,n,e,i,r,a,c,o){X(function(){G("_addImpression",t,n,e,i,r,a,c,o)}),H(function(){if(F._enhancedEcommerceEnabled(!0,"addImpression")){var s=function(t){return M("trackEcommerce",t,!0)};J(s,"ec:addImpression",{id:t,name:n,category:r,brand:i,variant:a,list:e,position:c,price:o})}})},this._addPromo=function(t,n,e,i){X(function(){G("_addPromo",t,n,e,i)}),H(function(){if(F._enhancedEcommerceEnabled(!0,"addPromo")){var r=function(t){return M("trackEcommerce",t,!0)};J(r,"ec:addPromo",{id:t,name:n,creative:e,position:i})}})},this._setAction=function(t,n){X(function(){G("_setAction",t,n)}),H(function(){if(F._enhancedEcommerceEnabled(!0,"setAction")){var e=function(t){return M("trackEcommerce",t,!0)};J(e,"ec:setAction",t,n)}})},this._trackTransaction=function(t,n,e,i,r,a,c,o,s){this._setAction("purchase",V(t,n,e,i,r,a,c,o,s))},this._trackRefund=function(t){this._setAction("refund",V(t))},this._trackCheckOut=function(t,n){this._setAction("checkout",V(null,null,null,null,null,null,null,t,n))},this._trackDetail=function(){this._setAction("detail"),this._pageView()},this._trackCart=function(t,n){-1!==["add","remove"].indexOf(t)&&(this._setAction(t,{list:n}),this._trackEvent("UX","click",t+("add"===t?" to cart":" from cart")))},this._promoClick=function(t){this._setAction("promo_click"),this._trackEvent("Internal Promotions","click",t)},this._productClick=function(t){this._setAction("click",V(null,null,null,null,null,null,t,null,null)),this._trackEvent("UX","click",t)},this._pageView=function(t){H(function(){z(U("send",t),"pageview")})},this._send=function(){var t=Array.prototype.slice.call(arguments);t.unshift("send"),H(function(){z.apply(F,t)})},this._set=function(t,n,e){H(function(){z(U("set",e),t,n)})},this._trackTimings=function(t,e,i,r){H(function(){J(n,"send","timing",t,e,i,r)})},this._trackException=function(t,e){H(function(){J(n,"send","exception",{exDescription:t,exFatal:!!e})})},m||(o?this._createAnalyticsScriptTag():this._createScriptTag()),x&&q.$on(T,function(){(!A||R.current&&R.current.templateUrl&&!R.current.doNotTrack)&&F._trackPage()}),{log:F.log,offlineQueue:F.offlineQueue,configuration:{accounts:e,universalAnalytics:o,crossDomainLinker:l,crossLinkDomains:i,currency:f,debugMode:d,delayScriptTag:m,disableAnalytics:g,displayFeatures:p,domainName:r,ecommerce:F._ecommerceEnabled(),enhancedEcommerce:F._enhancedEcommerceEnabled(),enhancedLinkAttribution:y,experimentId:a,hybridMobileSupport:b,ignoreFirstPageLoad:v,logAllCalls:E,pageEvent:T,readFromRoute:A,removeRegExp:c,testMode:D,traceDebuggingMode:C,trackPrefix:P,trackRoutes:x,trackUrlParams:j},getUrl:B,setCookieConfig:F._setCookieConfig,getCookieConfig:function(){return s},createAnalyticsScriptTag:function(t){return t&&(s=t),F._createAnalyticsScriptTag()},createScriptTag:function(){return F._createScriptTag()},offline:function(t){if(t===!0&&w===!1&&(w=!0),t===!1&&w===!0)for(w=!1;F.offlineQueue.length>0;){var n=F.offlineQueue.shift();n[0].apply(F,n[1])}return w},trackPage:function(t,n,e,i){F._trackPage.apply(F,arguments)},trackEvent:function(t,n,e,i,r,a){F._trackEvent.apply(F,arguments)},addTrans:function(t,n,e,i,r,a,c,o,s){F._addTrans.apply(F,arguments)},addItem:function(t,n,e,i,r,a){F._addItem.apply(F,arguments)},trackTrans:function(){F._trackTrans.apply(F,arguments)},clearTrans:function(){F._clearTrans.apply(F,arguments)},addProduct:function(t,n,e,i,r,a,c,o,s,u){F._addProduct.apply(F,arguments)},addPromo:function(t,n,e,i){F._addPromo.apply(F,arguments)},addImpression:function(t,n,e,i,r,a,c,o){F._addImpression.apply(F,arguments)},productClick:function(t){F._productClick.apply(F,arguments)},promoClick:function(t){F._promoClick.apply(F,arguments)},trackDetail:function(){F._trackDetail.apply(F,arguments)},trackCart:function(t,n){F._trackCart.apply(F,arguments)},trackCheckout:function(t,n){F._trackCheckOut.apply(F,arguments)},trackTimings:function(t,n,e,i){F._trackTimings.apply(F,arguments)},trackTransaction:function(t,n,e,i,r,a,c,o,s){F._trackTransaction.apply(F,arguments)},trackException:function(t,n){F._trackException.apply(F,arguments)},setAction:function(t,n){F._setAction.apply(F,arguments)},pageView:function(){F._pageView.apply(F,arguments)},send:function(t){F._send.apply(F,arguments)},set:function(t,n,e){F._set.apply(F,arguments)}}}]}).directive("gaTrackEvent",["Analytics","$parse",function(t,n){return{restrict:"A",link:function(e,i,r){var a=n(r.gaTrackEvent);i.bind("click",function(){(!r.gaTrackEventIf||e.$eval(r.gaTrackEventIf))&&a.length>1&&t.trackEvent.apply(t,a(e))})}}}]),t.module("angular-google-analytics")});
